# =====================================
# Vélib' Forecast — API & Jobs Environment (.env)
# =====================================

# ===== Mode stockage / maquette locale =====
STORAGE_BACKEND=local
DATA_ROOT=./data-local
GCS_LOCAL_ROOT_PREFIX=gs://velib-forecast-472820_cloudbuild/velib/

# ===== GCP / GCS =====
GOOGLE_CLOUD_PROJECT=velib-forecast-472820

# Snapshots 5min bruts (bronze)
GCS_RAW_PREFIX=gs://velib-forecast-472820_cloudbuild/velib/bronze

# Données compactées journalières
GCS_DAILY_PREFIX=gs://velib-forecast-472820_cloudbuild/velib/daily

# Données exports (événements, performances, etc.)
GCS_EXPORTS_PREFIX=gs://velib-forecast-472820_cloudbuild/velib/exports

# Monitoring (JSON/CSV produits par les jobs de suivi)
GCS_MONITORING_PREFIX=gs://velib-forecast-472820_cloudbuild/velib/monitoring

# Données de serving (prévisions prêtes pour l'API)
GCS_SERVING_PREFIX=gs://velib-forecast-472820_cloudbuild/velib/serving
GCS_FORECAST_PREFIX=gs://velib-forecast-472820_cloudbuild/velib/serving/forecast

# ===== Modèles (LightGBM) =====
# Modèles par horizon
GCS_MODEL_URI_H15=gs://velib-forecast-472820_cloudbuild/velib/models/h15/latest/model_h15.joblib
GCS_MODEL_URI_H60=gs://velib-forecast-472820_cloudbuild/velib/models/h60/latest/model_h60.joblib

# Alias générique (fallback)
GCS_MODEL_URI=gs://velib-forecast-472820_cloudbuild/velib/models/h15/latest/model_h15.joblib


# Horizons supportés par l’API et les jobs
FORECAST_SUPPORTED=15,60
FORECAST_HORIZONS=15,60

# ===== Live Vélib' (snapshot) =====
VELIB_STATUS_URL=https://velib-metropole-opendata.smovengo.cloud/opendata/Velib_Metropole/station_status.json
VELIB_INFO_URL=https://velib-metropole-opendata.smovengo.cloud/opendata/Velib_Metropole/station_information.json

# ===== Météo (Open-Meteo) =====
OPENMETEO_URL=https://api.open-meteo.com/v1/forecast
OPENMETEO_LAT=48.8566
OPENMETEO_LON=2.3522
OPENMETEO_TIMEOUT=5.0
METEO_DISABLE=false

# ===== Seuils & historique =====
# minutes d'historique du jour-1 (4h)
HISTORY_BACK_MIN=240
PENURY_THRESH=2
SATURATION_THRESH=2

# ===== API / Runtime =====
TZ_APP=Europe/Paris
TMP_DIR=/tmp
PYTHONUNBUFFERED=1
LOG_LEVEL=INFO
IMAGE_TAG=v1
API_CACHE_TTL_S=120
FORECAST_CACHE_TTL_SECONDS=120
UVICORN_TIMEOUT_S=120

# ===== CORS =====
# NOTE: valeur JSON STRICT (pas de virgule finale, pas de slash final dans les domaines)
CORS_ORIGINS=["https://velo-paris.fr","http://localhost:3000","http://127.0.0.1:3000","http://localhost:5050","http://127.0.0.1:5050"]
CORS_ALLOWED_METHODS=GET,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,If-None-Match

# ===== Appels internes (badges) =====
API_SELF_BASE=https://api.velo-paris.fr
LIVE_SNAPSHOT_URL=/snapshot

# ===== Options jobs =====
# Suppression auto des snapshots 5min après compaction (1=oui, 0=non)
DELETE_AFTER_COMPACT=1
