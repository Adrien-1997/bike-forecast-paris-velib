:root{
  /* Theme */
  --bg:#0b0b10; --panel:#12131a; --muted:#9aa3ad; --accent:#3aa5ff; --good:#3cc36b; --warn:#ffb020; --bad:#ff4d4f;
  /* Rhythm */
  --radius-sm:10px; --radius:12px; --radius-lg:14px; --gap:12px; --header-h:46px;
  --gap-v-desktop:8px;   /* souffle header↔contenu & contenu↔footer (desktop) */
  --gap-v-mobile:6px;    /* idem mobile */
  /* Type */
  --fs-12:.75rem; --fs-14:.875rem; --fs-16:1rem; --fs-18:1.125rem; --fs-20:1.25rem;
  /* Elevation */
  --shadow-1:0 4px 14px rgba(0,0,0,.22);
}

html,body,#__next{height:100%; margin:0; padding:0}
*{box-sizing:border-box}
:focus-visible{outline:2px solid color-mix(in srgb,var(--accent),#fff 10%);outline-offset:2px;border-radius:6px}
::selection{background:color-mix(in srgb,var(--accent) 30%, #fff 0%);color:#fff}

body{
  background:var(--bg); color:#e6e9ef;
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica Neue,Arial,"Apple Color Emoji","Segoe UI Emoji";
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; text-rendering:optimizeLegibility;
}

/* ===== Scrollbar (WebKit) ===== */
*::-webkit-scrollbar{width:10px;height:10px}
*::-webkit-scrollbar-track{background:#0f1117}
*::-webkit-scrollbar-thumb{background:#252839;border-radius:999px;border:2px solid #0f1117}

/* ===== Layout (non-sticky) ===== */
.container{
  min-height:100dvh;
  display:flex; flex-direction:column;
  row-gap:var(--gap-v-desktop);
}
.header{
  height:var(--header-h);
  padding:12px 16px;
  background:color-mix(in srgb,var(--panel) 92%, transparent);
  border-bottom:1px solid rgba(255,255,255,.06);
  display:flex; align-items:center; justify-content:space-between;
}
.main{
  flex:1;
  display:grid; grid-template-columns:minmax(0,1fr) 360px;
  gap:var(--gap);
  padding:var(--gap);
  min-height:0; /* évite les débordements internes */
}
.footer{
  text-align:center; padding:14px 16px;
  font-size:var(--fs-12); color:#9aa3ad;
  border-top:1px solid rgba(255,255,255,.06);
  background:color-mix(in srgb,var(--panel) 92%, transparent);
  margin-top:0;
}
.footer a{color:var(--accent); text-decoration:none; font-weight:600}
.footer a:hover{text-decoration:underline}

/* ===== Header — Titre & Sous-titre ===== */
.header h1{
  margin:0; display:flex; align-items:baseline; gap:10px;
  font-weight:800; font-size:clamp(1rem, 0.92rem + 1vw, 1.30rem);
  line-height:1.15; letter-spacing:.2px;
}
.header h1 .subtitle{
  color:var(--muted); font-weight:700; font-size:var(--fs-14);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.header .right{display:flex; gap:8px; align-items:center}
.header .toggle{display:inline-flex; border:1px solid rgba(255,255,255,.12); border-radius:var(--radius); overflow:hidden}
.header .toggle button{
  padding:10px 12px; background:transparent; color:#cfd6dd; border:0; cursor:pointer; font-weight:600; font-size:var(--fs-14);
  min-height:44px; min-width:44px; transition:background .15s ease;
}
.header .toggle button:hover{background:rgba(255,255,255,.06)}
.header .toggle button.active{background:#1b1d27; color:#fff}

/* ===== Panels ===== */
.panel{
  background:var(--panel); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius-lg);
  padding:12px; display:flex; flex-direction:column; min-height:0; min-width:0;
  box-shadow:var(--shadow-1);
}

/* ===== Map ===== */
.map-card{ padding:0 !important; overflow:hidden; display:flex; flex-direction:column; position:relative; border-radius:16px; }
.map-fill{ flex:1; min-height:520px; height:100% !important; }
.map-fill .leaflet-container{ width:100% !important; height:100% !important; display:block; border-radius:16px; }
.leaflet-container{background:#0f1117}

/* ===== Side panel / Stations proches ===== */
.side-panel{ display:flex; flex-direction:column; min-height:0; }
.side-panel .nearby-section{ flex:1; min-height:0; overflow:auto; -webkit-overflow-scrolling:touch; }
.side-panel .nearby-section .list{ max-height:none; }

/* ===== Badges / Inputs / List ===== */
.badges{display:flex; flex-wrap:wrap; gap:8px}
.badge{
  display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px;
  background:#1a1b22; border:1px solid rgba(255,255,255,.06); color:#cfd6dd; font-size:var(--fs-12); white-space:nowrap
}
.badge-dot{width:8px; height:8px; border-radius:999px; background:var(--accent)}
.input{
  width:100%; padding:12px; border-radius:var(--radius-sm); background:#101219;
  border:1px solid rgba(255,255,255,.08); color:#e6e9ef; font-size:var(--fs-14); min-height:44px
}
.input::placeholder{color:#7f8894}
.list{margin-top:10px; max-height:calc(100dvh - 220px); overflow:auto; -webkit-overflow-scrolling:touch}
.list .row{
  display:grid; grid-template-columns:1fr auto; gap:8px; padding:10px; border-radius:10px;
  transition:background .12s ease, transform .12s ease;
}
.list .row:hover{background:rgba(255,255,255,.04)}
.small{color:var(--muted); font-size:var(--fs-12)}

/* ===== KPI ===== */
.kpi{display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:8px}
.kpi .card{background:#11131b; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:12px; display:grid; align-content:center; min-height:70px}
.kpi .val{font-weight:700; font-size:var(--fs-20)}
.kpi .label{color:var(--muted); font-size:var(--fs-12)}

/* ===== Bouton "Ma position" ===== */
.map-fab{
  position:absolute; left:14px; bottom:14px; z-index:500;
  background:#1b1d27; color:#fff; border:1px solid rgba(255,255,255,.12);
  border-radius:999px; padding:10px 14px; font-weight:600;
  display:inline-flex; gap:8px; align-items:center;
  box-shadow:0 10px 24px rgba(0,0,0,.35);
}

/* ===== Tablets ===== */
@media (max-width:1200px){
  .main{grid-template-columns:minmax(0,1fr) 320px}
}

/* =========================================================
   Desktop (≥769px) — pas de scroll page, side panel scroll
   ========================================================= */
@media (min-width:769px){
  html, body { height:100%; overflow:hidden; }  /* bloque scroll global */
  .container { height:100dvh; overflow:hidden; }
  .main { overflow:hidden; }                     /* évite débordement du grid */

  .side-panel{
    min-height:0; overflow:auto;
    -webkit-overflow-scrolling:touch;
    overscroll-behavior:contain;
  }

  .map-fill{ min-height:0; } /* autorise la carte à s'adapter en hauteur */
}

/* =========================================================
   Mobile (≤768px) — carte sticky, contenu dessous qui scrolle
   ========================================================= */
@media (max-width:768px){
  .container{row-gap:var(--gap-v-mobile)}

  /* Titre mobile empilé proprement */
  .header{padding:8px 12px}
  .header h1{display:block; gap:0; line-height:1.12;}
  .header h1 > :first-child{display:block; white-space:nowrap; word-break:keep-all; letter-spacing:.2px;}
  .header h1 .subtitle{display:block; margin-top:2px; font-size:var(--fs-12); white-space:normal; overflow:visible; text-overflow:unset;}

  /* Layout mobile: page scrolle, carte sticky */
  .main{
    display:flex; flex-direction:column;
    padding:0 var(--gap);
    padding-top:var(--gap-v-mobile);
    padding-bottom:var(--gap-v-mobile);
    height:auto; min-height:0; overflow:visible;
  }

  .map-card{
    position:sticky; top:0; z-index:5;
    flex:0 0 auto; height:56vh;            /* ajuste 52–60vh si besoin */
    margin-bottom:var(--gap-v-mobile);
    border-radius:16px;
  }
  .map-fill{ height:100%; min-height:0; }
  .map-fill .leaflet-container{
    height:100% !important; border-radius:14px;
    touch-action: pan-x pinch-zoom;        /* évite le pan vertical qui accroche */
  }

  /* Contenu sous la carte — scrolle avec la page */
  .side-panel{
    flex:1 1 0; min-height:0;
    overflow:visible;                       /* pas de scroll interne mobile */
  }

  /* Assure que la liste peut s'étendre et défiler avec la page */
  .side-panel .list{ max-height:none !important; overflow:visible; }

  /* Contrôles Leaflet ergonomiques */
  .leaflet-control-zoom a{width:44px; height:44px; line-height:44px; border-radius:12px; font-size:20px}
  .leaflet-right .leaflet-control{margin-right:14px}
  .leaflet-bottom .leaflet-control{margin-bottom:14px}
  .leaflet-control-attribution{font-size:11px; padding:3px 6px; border-radius:8px; background:rgba(0,0,0,.35); color:#cfd6dd; border:0}

  /* Respecte la safe-area iOS en bas */
  .map-fab{bottom:calc(env(safe-area-inset-bottom) + 14px)}
}

/* ===== Small phones ===== */
@media (max-width:480px){
  :root{--gap:8px}
  .kpi{grid-template-columns:1fr}
}

/* ===== iOS safe areas (marges latérales sûres) ===== */
@supports (padding:max(0px)){
  .header{
    padding-left:max(16px,env(safe-area-inset-left));
    padding-right:max(16px,env(safe-area-inset-right));
  }
  .main{
    padding-left:max(var(--gap),env(safe-area-inset-left));
    padding-right:max(var(--gap),env(safe-area-inset-right));
  }
}

/* ===== Motion ===== */
@media (prefers-reduced-motion:reduce){
  *{animation-duration:.001ms !important; animation-iteration-count:1 !important; transition-duration:.001ms !important; scroll-behavior:auto !important}
}
