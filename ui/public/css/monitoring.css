/* /public/css/monitoring.css
   ==========================================================================
   Monitoring UI — scoped styles (no bleed to app/landing)
   Tout est sous .monitoring
   ==========================================================================
*/

/* (Optionnel) Police par défaut si Urbanist n’est pas injectée */
:root {
  --mn-font: var(--font-urbanist, ui-sans-serif), system-ui, -apple-system,
             "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial,
             "Apple Color Emoji", "Segoe UI Emoji";
}

/* ======================= TOKENS (dark par défaut) ======================= */
:root{
  /* Couleurs / tokens (alignés landing) */
  --bg:#0b1220;
  --bg-soft: rgba(15, 23, 42, 0.50);
  --bg-softer: rgba(15, 23, 42, 0.35);
  --panel:#0f172a;
  --panel-2:#0c1324;
  --text:#e6eaf2;
  --text-dim:#9ca3af;

  --primary:#ff6a00;
  --primary-2:#1d7fff;
  --accent:#59d4ff;
  --accentA: rgba(29,127,255,0.18);

  --ok:#22c55e;
  --warn:#f59e0b;
  --err:#ef4444;
  --info:#38bdf8;

  /* Rayons / ombres */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;

  --shadow-1: 0 10px 30px rgba(0,0,0,.25);
  --shadow-2: 0 6px 18px rgba(0,0,0,.20);

  /* Gaps */
  --gap-1: 6px;
  --gap-2: 8px;
  --gap-3: 12px;
  --gap-4: 16px;
  --gap-5: 20px;

  /* Halos */
  --halo-o: rgba(255,106,0,.10);
  --halo-b: rgba(29,127,255,.12);
  --halo-mix: linear-gradient(180deg, rgba(255,106,0,.05), rgba(29,127,255,.05));

  /* Hauteurs des plots */
  --plot-h-sm: clamp(220px, 36vh, 320px);
  --plot-h-lg: clamp(280px, 46vh, 380px);
}

/* Thème clair */
@media (prefers-color-scheme: light){
  :root{
    --bg:#f9fafb;
    --bg-soft: rgba(255,255,255,0.86);
    --bg-softer: rgba(255,255,255,0.72);
    --panel:#ffffff;
    --panel-2:#f7f9fd;
    --text:#111827;
    --text-dim:#6e7788;

    --shadow-1: 0 12px 28px rgba(0,0,0,.12), 0 2px 8px rgba(0,0,0,.06);
    --shadow-2: 0 8px 18px rgba(0,0,0,.08);

    --halo-o: rgba(255,106,0,.12);
    --halo-b: rgba(29,127,255,.14);
    --halo-mix: linear-gradient(180deg, rgba(255,106,0,.06), rgba(29,127,255,.06));
  }
}

/* ======================= FOND DE PAGE ======================= */
html:has(.monitoring),
body:has(.monitoring){
  background:
    radial-gradient(60vmax 60vmax at 18% -10%, var(--halo-o), transparent 55%),
    radial-gradient(70vmax 70vmax at 82% 110%, var(--halo-b), transparent 55%),
    var(--halo-mix),
    var(--bg);
  background-blend-mode: normal, normal, saturation, normal;
  color: var(--text);
}

/* ======================= SCOPE ======================= */
.monitoring {
  color: var(--text);
  font-family: var(--mn-font);
  background: transparent;
  position: relative;
}

/* ======================= LAYOUT GÉNÉRAL ======================= */
.monitoring .page{
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}
@supports (padding:max(0px)){
  .monitoring .page{
    padding-left: max(24px, env(safe-area-inset-left));
    padding-right: max(24px, env(safe-area-inset-right));
  }
}

/* ======================= TYPO ======================= */
.monitoring h1{ font-size:1.75rem; line-height:1.2; margin:0 0 6px; }
.monitoring h2{ font-size:1.25rem; line-height:1.35; margin:12px 0 10px; font-weight:700; letter-spacing:.2px; }
.monitoring h3{ font-size:1rem;   line-height:1.35; margin:6px 0 8px;  font-weight:700; letter-spacing:.2px; }
.monitoring .muted{ color:var(--text-dim); opacity:.9; }
.monitoring .small{ font-size:12px; color:var(--text-dim); }

/* ======================= PANELS / CARDS — UNIFIÉS ======================= */
/* Base “verre” commune à tous les conteneurs de données */
.monitoring .card,
.monitoring .panel,
.monitoring .plot-card,
.monitoring .map-block{
  border: 1px solid rgba(255,255,255,.12);
  background:
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)),
    var(--panel-2, #0c1324);
  border-radius: var(--radius-md);
  box-shadow: none;
  backdrop-filter: saturate(150%) blur(14px);
  -webkit-backdrop-filter: saturate(150%) blur(14px);
  transition: background .18s ease, box-shadow .18s ease;
}

/* Padding cohérent */
.monitoring .card,
.monitoring .panel{ padding: 14px 14px 16px; }
.monitoring .plot-card{ padding: 14px 14px 16px; } /* évite le gonflement bas */
.monitoring .map-block{ overflow: hidden; }

/* Titres internes harmonisés */
.monitoring .card > h3,
.monitoring .panel > h3,
.monitoring .plot-card > h3{
  margin: 6px 0 8px;
  font-weight: 700;
  letter-spacing: .2px;
  line-height: 1.25;
}

/* Hovers : sobres — pas de lift sur les blocs de data */
.monitoring .card:hover,
.monitoring .panel:hover,
.monitoring .plot-card:hover,
.monitoring .map-block:hover{
  box-shadow: none;
  background:
    linear-gradient(180deg, rgba(255,255,255,.065), rgba(255,255,255,.033)),
    var(--panel-2);
}

/* Thème clair — mêmes bases pour tous les conteneurs */
@media (prefers-color-scheme: light){
  .monitoring .card,
  .monitoring .panel,
  .monitoring .plot-card,
  .monitoring .map-block{
    background:
      linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78)),
      var(--panel-2, #f7f9fd);
    border: 1px solid rgba(0,0,0,.08);
    backdrop-filter: saturate(160%) blur(12px);
    -webkit-backdrop-filter: saturate(160%) blur(12px);
  }
}

/* ======================= BOUTONS ======================= */
.monitoring .btn{
  display:inline-flex; align-items:center; justify-content:center;
  gap:6px; padding:8px 12px; line-height:1;
  border-radius: var(--radius-sm);
  border:1px solid color-mix(in srgb, var(--text) 10%, transparent);
  background: transparent; color: var(--text); text-decoration:none;
  font-size:.95rem; cursor:pointer;
  transition: background .15s, border-color .15s, color .15s;
}
.monitoring .btn:hover{ background: rgba(255,255,255,.06); }
.monitoring .btn:focus-visible{ outline:none; box-shadow:0 0 0 3px rgba(29,127,255,.35); }
.monitoring .btn.btn--primary{
  background: var(--panel-2);
  color: var(--text);
  border: 1px solid color-mix(in srgb, var(--text) 10%, transparent);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
  font-weight: 600;
}
.monitoring .btn.btn--primary:hover{ background: var(--panel); }
.monitoring .btn.btn--ghost{ background: transparent; color: var(--text); }

/* ======================= FILTRES / INPUTS ======================= */
.monitoring .filters{ display:flex; gap:var(--gap-2); flex-wrap:wrap; align-items:center; margin:4px 0 12px; }
.monitoring .input,.monitoring .select{
  padding:6px 8px; border-radius: var(--radius-sm);
  border:1px solid color-mix(in srgb, var(--text) 10%, transparent);
  background: var(--panel-2);
  color: var(--text); font-size:.95rem;
}
.monitoring .check{ display:inline-flex; gap:6px; align-items:center; font-size:.95rem; }

/* ======================= MAP ======================= */
.monitoring .map-wrap{
  position:relative; width:100%;
  height:auto;
  min-height: clamp(260px, 50vh, 520px);
}
.monitoring .leaflet-container{ height:100%; width:100%; background: var(--panel) !important; }

/* Légende (utilisable si on pose .cluster-legend dans le DOM) */
.monitoring .cluster-legend{
  position:absolute; right:8px; bottom:8px; z-index:1000;
  background: color-mix(in srgb, #fff 92%, transparent);
  color:#111; border:1px solid #0001; border-radius:10px; padding:8px 10px;
  font-size:12px; box-shadow: var(--shadow-2);
  max-width: calc(100% - 16px);
  word-wrap: break-word; white-space: normal; line-height: 1.25;
}
.monitoring .cluster-legend__title{ font-weight:700; margin-bottom:6px; }
.monitoring .cluster-legend__row{ display:flex; align-items:center; gap:6px; margin:2px 0; } /* <- fix */
.monitoring .cluster-legend__dot{ width:12px; height:12px; border-radius:999px; border:1px solid #0002; display:inline-block; }
.monitoring .cluster-legend__meta{ opacity:.7; margin-top:6px; }

/* ======================= GRIDS / SPACING ======================= */
.monitoring .grid-2{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:var(--gap-4); }
.monitoring .grid-3{ display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:var(--gap-4); }
.monitoring .grid-4{ display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: var(--gap-4); }
.monitoring .grid-4 > .card{ height: 100%; }

.monitoring .row{ display:flex; align-items:center; gap:var(--gap-3); }
.monitoring .mt-2{ margin-top:8px; }
.monitoring .mt-3{ margin-top:12px; }
.monitoring .mt-4{ margin-top:16px; }
.monitoring .mt-5{ margin-top:20px; }
.monitoring .mt-6{ margin-top:24px; }

/* ======================= LISTES / DOTS ======================= */
.monitoring .status-list,
.monitoring .activity,
.monitoring .links,
.monitoring .tips{
  display:grid; gap:8px;
  padding-left: 0;
  list-style: none;
}
.monitoring .links li,
.monitoring .tips li,
.monitoring .status-list li,
.monitoring .activity li{ line-height:1.4; }
.monitoring .dot{ display:inline-block; width:10px; height:10px; border-radius:999px; margin-right:6px; }
.monitoring .dot--ok{ background: var(--ok); }
.monitoring .dot--warn{ background: var(--warn); }

/* ======================= A11y / MOTION ======================= */
.monitoring :focus-visible{
  outline:none; box-shadow:0 0 0 3px rgba(29,127,255,.35); border-radius:10px;
}
@media (prefers-reduced-motion: reduce){
  .monitoring *{
    animation-duration:.01ms !important;
    animation-iteration-count:1 !important;
    transition-duration:.01ms !important;
    scroll-behavior:auto !important;
  }
}

/* ======================= CAPTIONS / EMPTY ======================= */
.monitoring .figure-note{ color: var(--text-dim); }
.monitoring .plot-card + .figure-note,
.monitoring .map-block + .figure-note{ margin-top: 8px; }

.monitoring .empty{
  display: grid; place-items: center;
  min-height: 120px;
  color: var(--text-dim); opacity: .9;
}

/* ======================= PLOTLY — TYPO & LECTURE ======================= */
.monitoring .plot{
  width: 100%;
  min-height: 220px;
  display: block;
  margin-left: auto; margin-right: auto;
}
.monitoring .plot--sm{ height: var(--plot-h-sm); }
.monitoring .plot--lg{ height: var(--plot-h-lg); }

.monitoring .plot .main-svg{
  font-family: var(--mn-font) !important;
  font-feature-settings: "tnum" 1, "lnum" 1;
  display: block; margin: 0 auto;
}
.monitoring .plot .legend text{ fill: var(--text-dim) !important; font-size: 13px !important; }
.monitoring .plot .legend{ pointer-events: auto; }
.monitoring .plot .xtick text,
.monitoring .plot .ytick text{
  fill: var(--text-dim) !important;
  font-size: 13.5px !important; font-weight: 500 !important; letter-spacing: .2px;
}
.monitoring .plot .g-xtitle text,
.monitoring .plot .g-ytitle text{
  fill: var(--text) !important;
  font-size: 14px !important; font-weight: 700 !important; letter-spacing: .2px;
}
.monitoring .plot .gridlayer .xgrid,
.monitoring .plot .gridlayer .ygrid{ stroke: rgba(255,255,255,.12) !important; stroke-width: 1 !important; }
@media (prefers-color-scheme: light){
  .monitoring .plot .gridlayer .xgrid,
  .monitoring .plot .gridlayer .ygrid{ stroke: rgba(0,0,0,.12) !important; }
}
.monitoring .plot .xaxislayer-above path,
.monitoring .plot .yaxislayer-above path{
  stroke: color-mix(in srgb, var(--text) 35%, transparent) !important;
  stroke-width: 1 !important; opacity: .9;
}
.monitoring .plot .zerolinelayer path{ display: none !important; }

/* ======================= MÉTADONNÉES KPI & MINI-KPI ======================= */
.monitoring .kpi-bar-meta{
  margin-top: 6px; color: var(--text-dim); font-size: 12px;
}
.monitoring .kpi{
  display: grid; gap: 2px;
  padding: 6px 10px;
  border: 1px solid color-mix(in srgb, var(--text) 10%, transparent);
  border-radius: var(--radius-sm);
  background: var(--bg-softer);
}
.monitoring .kpi__label{ font-size: 11.5px; color: var(--text-dim); }
.monitoring .kpi__value{ font-size: 15px; font-variant-numeric: tabular-nums; }

/* ======================= MINI BARRES ======================= */
.monitoring .bar{
  height:6px; border-radius:999px; background:#111827;
  position:relative; overflow:hidden;
}
.monitoring .bar__fill{ height:100%; background: var(--ok); }
.monitoring .bar__fill--danger{ background: var(--err); }

/* ======================= RESPONSIVE ======================= */
@media (max-width:1024px){
  .monitoring .grid-3{ grid-template-columns: repeat(2, minmax(0,1fr)); }
  .monitoring .grid-4{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}
@media (max-width:640px){
  .monitoring .grid-2, .monitoring .grid-3, .monitoring .grid-4{ grid-template-columns: 1fr; }
  .monitoring .page{ padding:1.2rem; }
}
@media (max-width:480px){
  .monitoring .cluster-legend{
    font-size: 11px; padding: 6px 8px; right: 6px; bottom: 6px; border-radius: 8px;
  }
  .monitoring .cluster-legend__dot{ width:10px; height:10px; }
}
@media (max-width:400px){
  .monitoring .map-wrap{ min-height: clamp(220px, 48vh, 480px); }
}

/* ======================= CENTRAGE GLOBAL / BREATHING ======================= */
.container,
.mn-page,
.monitoring-container{
  max-width: 1200px; width: 100%;
  margin-left: auto; margin-right: auto;
  padding-left: 24px; padding-right: 24px;
}
.mt2{ margin-top: var(--gap-2) !important; }
section > .glass:last-child,
main > .glass:last-child,
.container > .glass:last-child{
  margin-bottom: calc(var(--gap-3) + 10px);
}
@media (max-width:740px){
  section > .glass:last-child,
  main > .glass:last-child,
  .container > .glass:last-child{
    margin-bottom: calc(var(--gap-3) + 6px);
  }
}

/* ======================================================================
   PLOT-CARD — intégration Plotly
   ====================================================================== */

/* Conteneur : rayon + clipping + padding régulier */
.monitoring .plot-card {
  border-radius: var(--radius-md);
  overflow: hidden;                 /* masque débords SVG/modebar */
  padding: 10px 12px 12px;
}

/* Racine react-plotly : s’étire proprement */
.monitoring .plot-card .plot {
  display: block;
  width: 100% !important;
  height: var(--plot-h-lg);         /* par défaut ; passer .plot--sm si besoin */
  margin: 0;
  touch-action: pan-x pan-y;        /* évite scroll “collant” sur mobile */
}

/* Sous-conteneurs Plotly */
.monitoring .plot-card .plot .plot-container,
.monitoring .plot-card .plot .svg-container {
  width: 100% !important;
  height: 100% !important;
}

/* Légende lisible sans déborder */
.monitoring .plot-card .plot .legend {
  max-width: calc(100% - 16px);
  overflow: hidden;
}
.monitoring .plot-card .plot .legend text {
  white-space: nowrap;
  text-overflow: ellipsis;
}

/* Axes/grilles : épaisseur stable au zoom */
.monitoring .plot-card .plot .xaxislayer-above path,
.monitoring .plot-card .plot .yaxislayer-above path {
  vector-effect: non-scaling-stroke;
}

/* Modebar discrète dans le padding */
.monitoring .plot-card .plot .modebar {
  top: 8px !important;
  right: 8px !important;
  left: auto !important;
  background: rgba(0,0,0,.25) !important;
  border-radius: 8px !important;
  padding: 0 2px !important;
  backdrop-filter: blur(6px) saturate(130%);
  -webkit-backdrop-filter: blur(6px) saturate(130%);
  transition: opacity .15s ease;
  opacity: .75;
}
.monitoring .plot-card .plot .modebar:hover { opacity: 1; }
.monitoring .plot-card .plot .modebar-btn { filter: none !important; }
.monitoring .plot-card .plot .modebar-group { border: none !important; }

/* Variante compacte */
.monitoring .plot-card .plot.plot--sm {
  height: var(--plot-h-sm);
}

/* Thème clair : modebar plus lisible */
@media (prefers-color-scheme: light) {
  .monitoring .plot-card .plot .modebar {
    background: rgba(255,255,255,.7) !important;
  }
}

/* Sécurité titres d’axes (labels longs) */
.monitoring .plot-card .plot .g-xtitle text,
.monitoring .plot-card .plot .g-ytitle text {
  paint-order: stroke fill;
  stroke: transparent;
  stroke-width: 0;
}


/* ======================================================================
   TABLE-GRID — tableaux unifiés (Health / Drift / Dynamics)
   ====================================================================== */

/* Conteneur scroll horizontal si besoin */
.monitoring .table-scroll { overflow-x: auto; }

/* Grille “table” : colonnes via --cols */
.monitoring .table-grid {
  display: grid;
  gap: var(--gap-2);
  min-width: 720px;
  grid-template-columns: var(--cols, 1fr);
}

/* ====== TABLE HEADERS (intégrés, symétriques et cohérents) ====== */
.monitoring .table-head {
  padding: 8px 8px;
  font-size: 12px;
  font-weight: 700;
  letter-spacing: .25px;
  text-transform: uppercase;
  color: var(--text-dim);
  background: color-mix(in srgb, var(--panel) 88%, transparent);
  border-bottom: 1px solid color-mix(in srgb, var(--text) 35%, transparent);
  backdrop-filter: saturate(140%) blur(6px);
  -webkit-backdrop-filter: saturate(140%) blur(6px);
  box-shadow: inset 0 -1px 0 color-mix(in srgb, var(--text) 28%, transparent);
  border-top-left-radius: var(--radius-sm);
  border-top-right-radius: var(--radius-sm);
}

/* Collant en haut lors du scroll */
.monitoring .table-head--sticky {
  position: sticky;
  top: 0;
  z-index: 1;
}

/* Variante thème clair — contraste un peu plus marqué */
@media (prefers-color-scheme: light) {
  .monitoring .table-head {
    background: color-mix(in srgb, var(--panel) 94%, transparent);
    border-bottom-color: color-mix(in srgb, var(--text) 24%, transparent);
    box-shadow: inset 0 -1px 0 color-mix(in srgb, var(--text) 18%, transparent);
  }
}

/* Cellules */
.monitoring .table-cell {
  padding: 8px 6px;
  border-bottom: 1px dashed color-mix(in srgb, var(--text) 28%, transparent);
}
.monitoring .table-cell--right { text-align: right; }
.monitoring .table-cell--mono {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}
.monitoring .table-cell--ellipsis { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* Lignes (pattern Row) */
.monitoring .table-row { display: contents; }

/* Compteur discret à côté des filtres */
.monitoring .count-small { font-size: 12px; color: var(--text-dim); }

/* Badges */
.monitoring .badge {
  font-size: 12px;
  padding: 3px 8px;
  border-radius: 999px;
  display: inline-block;
  line-height: 1.2;
}
.monitoring .badge--ok   { background: rgba(16,185,129,0.15); border: 1px solid #10b981; color: #10b981; }
.monitoring .badge--warn { background: rgba(239,68,68,0.12); border: 1px solid #ef4444; color: #ef4444; }
.monitoring .badge--info { background: rgba(59,130,246,0.12); border: 1px solid #3b82f6; color: #3b82f6; }

/* Chips (reuse .btn / .btn--ghost) */
.monitoring .chip {
  border-radius: 999px;
  border-color: color-mix(in srgb, var(--text) 10%, transparent);
  background: transparent;
}
.monitoring .chip--active {
  outline: 1px solid var(--accent);
  background: var(--accentA);
  border-color: var(--accent);
}

/* Barres de progression mini */
.monitoring .bar__fill--ok { background: var(--ok); }

/* Aides typographiques */
.monitoring .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
.monitoring .text-right { text-align: right; }


/* ======================================================================
   MAP BLOCK — harmonisé avec les cards
   ====================================================================== */

.monitoring .map-block { margin-top: var(--gap-4); }

.monitoring .map-wrap {
  position: relative;
  border-radius: var(--radius);
  overflow: hidden;
  background: var(--panel);            /* même fond que .card / .plot-card */
  border: 1px solid color-mix(in srgb, var(--text) 10%, transparent);
  box-shadow: 0 2px 8px rgba(0,0,0,.2);
}

/* Taille standard */
.monitoring .map-wrap.h-360 { height: 360px; }

/* Leaflet container */
.monitoring .leaflet-container {
  width: 100%;
  height: 100%;
  background: var(--panel);            /* unifié */
}

/* Tooltips Leaflet (thème) */
.monitoring .tooltip-dark,
.monitoring .leaflet-tooltip {
  background: var(--panel-2);
  color: var(--text);
  border: 1px solid color-mix(in srgb, var(--text) 15%, transparent);
  border-radius: var(--radius-xs);
  padding: 4px 6px;
  font-size: 12px;
  backdrop-filter: saturate(140%) blur(6px);
}

/* TileLayer : fond unifié si charge lente */
.monitoring .tile-bg { background: var(--panel); }
